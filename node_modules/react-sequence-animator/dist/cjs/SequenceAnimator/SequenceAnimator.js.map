{"version":3,"sources":["../../../src/SequenceAnimator/SequenceAnimator.tsx"],"names":["SequenceAnimator","React","Component","frame","state","childrenArr","_getChildrenArray","length","_animationFrame","requestAnimationFrame","_onAnimate","timestamp","props","onSequenceEnd","onAnimationStop","loop","easing","duration","_animationStart","nextFrame","Math","floor","setState","_playAnimation","componentDidMount","autoplay","start","componentWillUnmount","cancelAnimationFrame","stop","reset","render","_getFrame","children","Children","toArray"],"mappings":";;;;;;;;;AAAA;;AACA;;;;AAOO,MAAMA,gBAAN,SAA+BC,eAAMC,SAArC,CAGL;AAAA;AAAA;AAAA;AAAA;AAAA,iDAWQ;AACNC,MAAAA,KAAK,EAAE;AADD,KAXR;AAAA,qDAiDY,MAAM;AAChB,YAAQA,KAAR,GAAkB,KAAKC,KAAvB,CAAQD,KAAR;;AACA,YAAME,WAAW,GAAG,KAAKC,iBAAL,EAApB;;AAEA,aAAOD,WAAW,CAACE,MAAZ,IAAsBJ,KAAtB,GAA8BE,WAAW,CAACF,KAAD,CAAzC,GAAmD,IAA1D;AACD,KAtDD;AAAA,0DAwDiB,MAAM;AACrB,WAAKK,eAAL,GAAuBC,qBAAqB,CAAC,KAAKC,UAAN,CAA5C;AACD,KA1DD;AAAA,sDA4DcC,SAAD,IAAuB;AAClC,0BAMI,KAAKC,KANT;AAAA,YACEC,aADF,eACEA,aADF;AAAA,YAEEC,eAFF,eAEEA,eAFF;AAAA,YAGEC,IAHF,eAGEA,IAHF;AAAA,YAIEC,MAJF,eAIEA,MAJF;AAAA,YAKEC,QALF,eAKEA,QALF;;AAOA,YAAMZ,WAAW,GAAG,KAAKC,iBAAL,EAApB;;AAEA,UAAI,CAAC,KAAKY,eAAV,EAA2B;AACzB,aAAKA,eAAL,GAAuBP,SAAvB;AACD;;AAED,UAAIQ,SAAS,GAAGC,IAAI,CAACC,KAAL,CACd,kBAAKL,MAAL,EACEL,SAAS,GAAG,KAAKO,eADnB,EAEE,CAFF,EAGEb,WAAW,CAACE,MAHd,EAIEU,QAJF,CADc,CAAhB;;AASA,UAAIE,SAAS,GAAGd,WAAW,CAACE,MAAZ,GAAqB,CAArC,EAAwC;AACtC,YAAIM,aAAJ,EAAmB;AACjBA,UAAAA,aAAa;AACd;;AAED,YAAIE,IAAJ,EAAU;AACRI,UAAAA,SAAS,IAAId,WAAW,CAACE,MAAzB;AACA,eAAKW,eAAL,GAAuBP,SAAvB;AACD,SAHD,MAGO;AACLQ,UAAAA,SAAS,GAAG,CAAC,CAAb;AACD;AACF;;AAED,UAAIA,SAAS,GAAG,CAAC,CAAjB,EAAoB;AAClB,aAAKG,QAAL,CAAc;AAAEnB,UAAAA,KAAK,EAAEgB;AAAT,SAAd,EAAoC,MAAM;AACxC,eAAKI,cAAL;AACD,SAFD;AAGD,OAJD,MAIO,IAAIT,eAAJ,EAAqB;AAC1BA,QAAAA,eAAe;AAChB;AACF,KAvGD;AAAA;;AAeAU,EAAAA,iBAAiB,GAAG;AAClB,UAAQC,QAAR,GAAqB,KAAKb,KAA1B,CAAQa,QAAR;;AAEA,QAAIA,QAAJ,EAAc;AACZ,WAAKC,KAAL;AACD;AACF;;AAEDC,EAAAA,oBAAoB,GAAG;AACrBC,IAAAA,oBAAoB,CAAC,KAAKpB,eAAN,CAApB;AACD;;AAEDkB,EAAAA,KAAK,GAAG;AACN,SAAKH,cAAL;AACD;;AAEDM,EAAAA,IAAI,GAAG;AACLD,IAAAA,oBAAoB,CAAC,KAAKpB,eAAN,CAApB;AACD;;AAEDsB,EAAAA,KAAK,GAAG;AACN,SAAKR,QAAL,CAAc;AAAEnB,MAAAA,KAAK,EAAE;AAAT,KAAd;AACD;;AAED4B,EAAAA,MAAM,GAAG;AACP,UAAM5B,KAAK,GAAG,KAAK6B,SAAL,EAAd;;AACA,wBAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAM7B,KAAN,CAAP;AACD;;AAEDG,EAAAA,iBAAiB,GAAG;AAClB,UAAQ2B,QAAR,GAAqB,KAAKrB,KAA1B,CAAQqB,QAAR;AACA,WAAOhC,eAAMiC,QAAN,CAAeC,OAAf,CAAuBF,QAAQ,IAAI,EAAnC,CAAP;AACD;;AA/CD;;;8BAHWjC,gB,iBAIU,kB;8BAJVA,gB,kBAKyC;AAClDiB,EAAAA,QAAQ,EAAE,IADwC;AAElDQ,EAAAA,QAAQ,EAAE,IAFwC;AAGlDT,EAAAA,MAAM,EAAE,QAH0C;AAIlDD,EAAAA,IAAI,EAAE;AAJ4C,C","sourcesContent":["import React from 'react';\nimport { ease } from '../common';\nimport {\n  SequenceAnimatorProps,\n  SequenceAnimatorState,\n  SequenceAnimatorDefaultProps,\n} from './types';\n\nexport class SequenceAnimator extends React.Component<\n  SequenceAnimatorProps,\n  SequenceAnimatorState\n> {\n  static displayName = 'SequenceAnimator';\n  static defaultProps: SequenceAnimatorDefaultProps = {\n    duration: 1000,\n    autoplay: true,\n    easing: 'linear',\n    loop: true,\n  };\n  private _animationFrame: ReturnType<typeof requestAnimationFrame>;\n  private _animationStart: number | null;\n\n  state = {\n    frame: 0,\n  };\n\n  componentDidMount() {\n    const { autoplay } = this.props;\n\n    if (autoplay) {\n      this.start();\n    }\n  }\n\n  componentWillUnmount() {\n    cancelAnimationFrame(this._animationFrame);\n  }\n\n  start() {\n    this._playAnimation();\n  }\n\n  stop() {\n    cancelAnimationFrame(this._animationFrame);\n  }\n\n  reset() {\n    this.setState({ frame: 0 });\n  }\n\n  render() {\n    const frame = this._getFrame();\n    return <div>{frame}</div>;\n  }\n\n  _getChildrenArray() {\n    const { children } = this.props;\n    return React.Children.toArray(children || []);\n  }\n\n  _getFrame = () => {\n    const { frame } = this.state;\n    const childrenArr = this._getChildrenArray();\n\n    return childrenArr.length >= frame ? childrenArr[frame] : null;\n  };\n\n  _playAnimation = () => {\n    this._animationFrame = requestAnimationFrame(this._onAnimate);\n  };\n\n  _onAnimate = (timestamp: number) => {\n    const {\n      onSequenceEnd,\n      onAnimationStop,\n      loop,\n      easing,\n      duration,\n    } = this.props;\n    const childrenArr = this._getChildrenArray();\n\n    if (!this._animationStart) {\n      this._animationStart = timestamp;\n    }\n\n    let nextFrame = Math.floor(\n      ease(easing)(\n        timestamp - this._animationStart,\n        0,\n        childrenArr.length,\n        duration,\n      ),\n    );\n\n    if (nextFrame > childrenArr.length - 1) {\n      if (onSequenceEnd) {\n        onSequenceEnd();\n      }\n\n      if (loop) {\n        nextFrame %= childrenArr.length;\n        this._animationStart = timestamp;\n      } else {\n        nextFrame = -1;\n      }\n    }\n\n    if (nextFrame > -1) {\n      this.setState({ frame: nextFrame }, () => {\n        this._playAnimation();\n      });\n    } else if (onAnimationStop) {\n      onAnimationStop();\n    }\n  };\n}\n"]}